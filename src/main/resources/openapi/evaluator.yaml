openapi: 3.0.3
info:
  title: API Desafio – Evaluator (Jogo da Velha)
  version: 1.0.0
  description: |
    Recebe um tabuleiro 3x3 preenchido com X, O ou EMPTY e retorna o resultado:
    vencedor (X ou O), empate (DRAW/velha) ou jogo em andamento (ONGOING).

servers:
  - url: http://localhost:8080

tags:
  - name: Evaluator
    description: Endpoints do avaliador de jogo da velha

paths:
  /api/evaluator/evaluate:
    post:
      tags: [Evaluator]
      operationId: evaluateBoard
      summary: Avalia um tabuleiro 3x3 de jogo da velha
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/EvaluateRequest' }
            examples:
              xWins:
                summary: X vence (diagonal principal)
                value:
                  board:
                    r1: { c1: X, c2: O, c3: X }
                    r2: { c1: O, c2: X, c3: O }
                    r3: { c1: EMPTY, c2: EMPTY, c3: X }
              oWins:
                summary: O vence (diagonal secundária)
                value:
                  board:
                    r1: { c1: O, c2: X, c3: EMPTY }
                    r2: { c1: X, c2: O, c3: EMPTY }
                    r3: { c1: EMPTY, c2: X, c3: O }
              draw:
                summary: Empate (tabuleiro cheio)
                value:
                  board:
                    r1: { c1: X, c2: O, c3: X }
                    r2: { c1: X, c2: O, c3: O }
                    r3: { c1: O, c2: X, c3: X }
              ongoing:
                summary: Jogo em andamento
                value:
                  board:
                    r1: { c1: X, c2: EMPTY, c3: EMPTY }
                    r2: { c1: EMPTY, c2: X, c3: O }
                    r3: { c1: O, c2: EMPTY, c3: X }
      responses:
        '200':
          description: Resultado da avaliação
          content:
            application/json:
              schema: { $ref: '#/components/schemas/EvaluateResponse' }
              examples:
                okXWins:
                  summary: X venceu
                  value:
                    status: X_WINS
                    winner: X
                okOWins:
                  summary: O venceu
                  value:
                    status: O_WINS
                    winner: O
                okDraw:
                  summary: Empate (velha)
                  value:
                    status: DRAW
                    winner: EMPTY
                okOngoing:
                  summary: Jogo em andamento
                  value:
                    status: ONGOING
                    winner: EMPTY
        '400':
          description: Requisição inválida (shape ≠ 3x3, valor fora do enum, JSON malformado)
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Error' }
              examples:
                shape:
                  summary: Matriz com shape inválido
                  value:
                    message: "board deve ser 3x3"
                enumValue:
                  summary: Valor fora do enum
                  value:
                    message: "requisição inválida: valor inválido para célula (X, O ou EMPTY esperados)"
                jsonMalformed:
                  summary: JSON malformado
                  value:
                    message: "requisição inválida: JSON mal formatado"
        '422':
          description: Tabuleiro inválido (regras do jogo violadas)
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Error' }
              examples:
                invalidCounts:
                  summary: Contagem inconsistente X−O
                  value:
                    message: "contagem inválida: X-O deve ser 0 ou 1"
                twoWinners:
                  summary: Dois vencedores ao mesmo tempo
                  value:
                    message: "X e O não podem vencer ao mesmo tempo"
                xWinsInconsistent:
                  summary: Vitória de X inválida
                  value:
                    message: "estado inconsistente no tabuleiro para vitória de X"

components:
  schemas:
    Mark:
      type: string
      description: Símbolo de cada célula
      enum: [X, O, EMPTY]

    RowDto:
      type: object
      additionalProperties: false
      required: [c1, c2, c3]
      properties:
        c1:
          allOf:
            - $ref: '#/components/schemas/Mark'
          description: Coluna 1
        c2:
          allOf:
            - $ref: '#/components/schemas/Mark'
          description: Coluna 2
        c3:
          allOf:
            - $ref: '#/components/schemas/Mark'
          description: Coluna 3

    BoardDto:
      type: object
      additionalProperties: false
      required: [r1, r2, r3]
      properties:
        r1:
          allOf:
            - $ref: '#/components/schemas/RowDto'
          description: Linha 1
        r2:
          allOf:
            - $ref: '#/components/schemas/RowDto'
          description: Linha 2
        r3:
          allOf:
            - $ref: '#/components/schemas/RowDto'
          description: Linha 3

    EvaluateRequest:
      type: object
      additionalProperties: false
      required: [board]
      properties:
        board:
          $ref: '#/components/schemas/BoardDto'

    GameStatus:
      type: string
      description: Resultado do jogo
      enum: [X_WINS, O_WINS, DRAW, ONGOING, INVALID]

    EvaluateResponse:
      type: object
      additionalProperties: false
      required: [status, winner]
      properties:
        status: { $ref: '#/components/schemas/GameStatus' }
        winner: { $ref: '#/components/schemas/Mark' }

    Error:
      type: object
      additionalProperties: false
      required: [message]
      properties:
        message: { type: string }
